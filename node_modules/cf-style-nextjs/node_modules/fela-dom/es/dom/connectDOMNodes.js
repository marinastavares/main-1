import { clusterCache, objectEach, RULE_TYPE, STATIC_TYPE, KEYFRAME_TYPE, FONT_TYPE } from 'fela-utils';

import initDOMNode from './initDOMNode';
import findDOMNodes from './findDOMNodes';

var sheetMap = {
  fontFaces: FONT_TYPE,
  statics: STATIC_TYPE,
  keyframes: KEYFRAME_TYPE,
  rules: RULE_TYPE
};

export default function connectDOMNodes(renderer) {
  renderer.nodes = findDOMNodes();

  var cacheCluster = clusterCache(renderer.cache, renderer.mediaQueryOrder);

  var baseNode = renderer.nodes[RULE_TYPE];

  objectEach(sheetMap, function (type, key) {
    if (cacheCluster[key].length > 0) {
      initDOMNode(renderer.nodes, baseNode, cacheCluster[key], type);
    }
  });

  objectEach(cacheCluster.mediaRules, function (clusteredCache, media) {
    if (clusteredCache.length > 0) {
      initDOMNode(renderer.nodes, baseNode, clusteredCache, RULE_TYPE, media);
    }
  });
}