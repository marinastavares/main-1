'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = renderToMarkup;

var _felaUtils = require('fela-utils');

var _createStyleTagMarkup = require('./createStyleTagMarkup');

var _createStyleTagMarkup2 = _interopRequireDefault(_createStyleTagMarkup);

var _getRehydrationIndex = require('./getRehydrationIndex');

var _getRehydrationIndex2 = _interopRequireDefault(_getRehydrationIndex);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var sheetMap = {
  fontFaces: _felaUtils.FONT_TYPE,
  statics: _felaUtils.STATIC_TYPE,
  keyframes: _felaUtils.KEYFRAME_TYPE,
  rules: _felaUtils.RULE_TYPE
};
function renderToMarkup(renderer) {
  var cacheCluster = (0, _felaUtils.clusterCache)(renderer.cache, renderer.mediaQueryOrder);

  var rehydrationIndex = (0, _getRehydrationIndex2.default)(renderer);

  var basicMarkup = (0, _felaUtils.objectReduce)(sheetMap, function (markup, type, key) {
    if (cacheCluster[key].length > 0) {
      markup += (0, _createStyleTagMarkup2.default)(cacheCluster[key], type, '', rehydrationIndex);
    }

    return markup;
  }, '');

  return (0, _felaUtils.objectReduce)(cacheCluster.mediaRules, function (markup, css, media) {
    if (css.length > 0) {
      markup += (0, _createStyleTagMarkup2.default)(css, _felaUtils.RULE_TYPE, media, rehydrationIndex);
    }

    return markup;
  }, basicMarkup);
}